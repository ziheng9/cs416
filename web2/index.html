<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rising Temperatures: A Climate Story</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-annotation/2.5.1/d3-annotation.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 18px;
        }
        
        #visualization {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 40px;
            margin-bottom: 20px;
        }
        
        .navigation {
            text-align: center;
            margin: 20px 0;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            margin: 0 10px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .scene-indicator {
            text-align: center;
            color: #666;
            margin: 10px 0;
        }
        
        .axis {
            font-size: 12px;
        }
        
        .axis-label {
            font-size: 14px;
            font-weight: bold;
        }
        
        .line {
            fill: none;
            stroke-width: 2;
        }
        
        .dot {
            cursor: pointer;
        }
        
        .tooltip {
            position: absolute;
            text-align: center;
            padding: 8px;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 4px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .annotation-note-title {
            font-weight: bold;
            font-size: 14px;
        }
        
        .annotation-note-label {
            font-size: 12px;
        }
        
        .interactive-note {
            text-align: center;
            color: #666;
            font-style: italic;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Rising Temperatures: A Climate Story</h1>
        <p class="subtitle">Understanding Global Temperature Anomalies from 1880 to 2023</p>
        
        <div id="visualization"></div>
        
        <div class="scene-indicator" id="sceneIndicator">Scene 1 of 3</div>
        
        <div class="navigation">
            <button id="prevBtn" onclick="previousScene()" disabled>Previous</button>
            <button id="nextBtn" onclick="nextScene()">Next</button>
        </div>
        
        <p class="interactive-note" id="interactiveNote" style="display: none;">
            Hover over data points to see detailed temperature information
        </p>
    </div>
    
    <div class="tooltip" id="tooltip"></div>

    <script>
        // Global parameters
        let currentScene = 1;
        const totalScenes = 3;
        let data = [];
        let isInteractive = false;
        
        // Chart dimensions
        const margin = {top: 20, right: 80, bottom: 60, left: 80};
        const width = 1000 - margin.left - margin.right;
        const height = 500 - margin.top - margin.bottom;
        
        // Create SVG
        const svg = d3.select("#visualization")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);
        
        // Generate sample data (temperature anomalies)
        function generateData() {
            const years = [];
            for (let year = 1880; year <= 2023; year++) {
                // Simulate temperature anomaly data with increasing trend
                const baseAnomaly = (year - 1880) * 0.008;
                const randomVariation = (Math.random() - 0.5) * 0.4;
                const anomaly = baseAnomaly + randomVariation + 
                    (year > 1970 ? (year - 1970) * 0.01 : 0);
                
                years.push({
                    year: year,
                    temperature: anomaly,
                    decade: Math.floor(year / 10) * 10
                });
            }
            return years;
        }
        
        // Initialize data
        data = generateData();
        
        // Scales
        const xScale = d3.scaleLinear()
            .domain([1880, 2023])
            .range([0, width]);
        
        const yScale = d3.scaleLinear()
            .domain(d3.extent(data, d => d.temperature))
            .range([height, 0]);
        
        const colorScale = d3.scaleSequential()
            .domain([1880, 2023])
            .interpolator(d3.interpolateRdYlBu)
            .clamp(true);
        
        // Line generator
        const line = d3.line()
            .x(d => xScale(d.year))
            .y(d => yScale(d.temperature))
            .curve(d3.curveMonotoneX);
        
        // Add axes
        svg.append("g")
            .attr("class", "x-axis axis")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(xScale).tickFormat(d3.format("d")));
        
        svg.append("g")
            .attr("class", "y-axis axis")
            .call(d3.axisLeft(yScale));
        
        // Add axis labels
        svg.append("text")
            .attr("class", "axis-label")
            .attr("transform", "rotate(-90)")
            .attr("y", 0 - margin.left + 20)
            .attr("x", 0 - (height / 2))
            .attr("dy", "1em")
            .style("text-anchor", "middle")
            .text("Temperature Anomaly (°C)");
        
        svg.append("text")
            .attr("class", "axis-label")
            .attr("transform", `translate(${width / 2}, ${height + margin.bottom - 10})`)
            .style("text-anchor", "middle")
            .text("Year");
        
        // Add zero line
        svg.append("line")
            .attr("class", "zero-line")
            .attr("x1", 0)
            .attr("x2", width)
            .attr("y1", yScale(0))
            .attr("y2", yScale(0))
            .style("stroke", "#999")
            .style("stroke-dasharray", "3,3");
        
        // Tooltip
        const tooltip = d3.select("#tooltip");
        
        // Scene functions
        function updateScene() {
            document.getElementById("sceneIndicator").textContent = `Scene ${currentScene} of ${totalScenes}`;
            document.getElementById("prevBtn").disabled = currentScene === 1;
            document.getElementById("nextBtn").disabled = currentScene === totalScenes;
            
            // Clear previous annotations
            svg.selectAll(".annotation-group").remove();
            
            switch(currentScene) {
                case 1:
                    scene1();
                    break;
                case 2:
                    scene2();
                    break;
                case 3:
                    scene3();
                    break;
            }
        }
        
        function scene1() {
            isInteractive = false;
            document.getElementById("interactiveNote").style.display = "none";
            
            // Show data up to 1950
            const earlyData = data.filter(d => d.year <= 1950);
            
            // Remove existing elements
            svg.selectAll(".line").remove();
            svg.selectAll(".dot").remove();
            
            // Draw line
            svg.append("path")
                .datum(earlyData)
                .attr("class", "line")
                .attr("d", line)
                .style("stroke", "#4682b4")
                .style("opacity", 0)
                .transition()
                .duration(1000)
                .style("opacity", 1);
            
            // Add annotation
            const annotations = [{
                note: {
                    title: "Early Industrial Era",
                    label: "Temperature anomalies were relatively stable with minor fluctuations",
                    wrap: 200
                },
                x: xScale(1920),
                y: yScale(0.1),
                dy: -50,
                dx: 50
            }];
            
            const makeAnnotations = d3.annotation()
                .type(d3.annotationLabel)
                .annotations(annotations);
            
            svg.append("g")
                .attr("class", "annotation-group")
                .call(makeAnnotations);
        }
        
        function scene2() {
            isInteractive = false;
            document.getElementById("interactiveNote").style.display = "none";
            
            // Show data up to 1990
            const midData = data.filter(d => d.year <= 1990);
            
            // Remove existing elements
            svg.selectAll(".line").remove();
            svg.selectAll(".dot").remove();
            
            // Draw line with color gradient
            midData.forEach((d, i) => {
                if (i < midData.length - 1) {
                    svg.append("path")
                        .datum([d, midData[i + 1]])
                        .attr("class", "line")
                        .attr("d", line)
                        .style("stroke", colorScale(d.year))
                        .style("opacity", 0)
                        .transition()
                        .duration(20)
                        .delay(i * 10)
                        .style("opacity", 1);
                }
            });
            
            // Add annotations
            const annotations = [
                {
                    note: {
                        title: "Post-War Boom",
                        label: "Rapid industrialization begins to show impact",
                        wrap: 180
                    },
                    x: xScale(1960),
                    y: yScale(0.2),
                    dy: -60,
                    dx: 40
                },
                {
                    note: {
                        title: "Warming Accelerates",
                        label: "Clear upward trend emerges in the 1970s",
                        wrap: 180
                    },
                    x: xScale(1975),
                    y: yScale(0.4),
                    dy: 40,
                    dx: 60
                }
            ];
            
            const makeAnnotations = d3.annotation()
                .type(d3.annotationLabel)
                .annotations(annotations);
            
            setTimeout(() => {
                svg.append("g")
                    .attr("class", "annotation-group")
                    .call(makeAnnotations);
            }, 1000);
        }
        
        function scene3() {
            isInteractive = true;
            document.getElementById("interactiveNote").style.display = "block";
            
            // Show all data
            svg.selectAll(".line").remove();
            svg.selectAll(".dot").remove();
            
            // Draw complete line with gradient
            data.forEach((d, i) => {
                if (i < data.length - 1) {
                    svg.append("path")
                        .datum([d, data[i + 1]])
                        .attr("class", "line")
                        .attr("d", line)
                        .style("stroke", colorScale(d.year))
                        .style("opacity", 0)
                        .transition()
                        .duration(10)
                        .delay(i * 5)
                        .style("opacity", 1);
                }
            });
            
            // Add interactive dots
            setTimeout(() => {
                svg.selectAll(".dot")
                    .data(data.filter((d, i) => i % 5 === 0)) // Show every 5th year
                    .enter().append("circle")
                    .attr("class", "dot")
                    .attr("cx", d => xScale(d.year))
                    .attr("cy", d => yScale(d.temperature))
                    .attr("r", 4)
                    .style("fill", d => colorScale(d.year))
                    .style("stroke", "white")
                    .style("stroke-width", 1)
                    .on("mouseover", function(event, d) {
                        d3.select(this)
                            .transition()
                            .duration(200)
                            .attr("r", 6);
                        
                        tooltip.transition()
                            .duration(200)
                            .style("opacity", .9);
                        
                        tooltip.html(`Year: ${d.year}<br/>Anomaly: ${d.temperature.toFixed(2)}°C`)
                            .style("left", (event.pageX + 10) + "px")
                            .style("top", (event.pageY - 28) + "px");
                    })
                    .on("mouseout", function(d) {
                        d3.select(this)
                            .transition()
                            .duration(200)
                            .attr("r", 4);
                        
                        tooltip.transition()
                            .duration(500)
                            .style("opacity", 0);
                    });
            }, 800);
            
            // Add final annotations
            const annotations = [
                {
                    note: {
                        title: "21st Century Crisis",
                        label: "Unprecedented warming rates threaten global climate stability",
                        wrap: 200
                    },
                    x: xScale(2010),
                    y: yScale(1.2),
                    dy: -40,
                    dx: -100
                },
                {
                    note: {
                        title: "Recent Records",
                        label: "Multiple record-breaking years in succession",
                        wrap: 150
                    },
                    x: xScale(2020),
                    y: yScale(1.4),
                    dy: 30,
                    dx: -80
                }
            ];
            
            const makeAnnotations = d3.annotation()
                .type(d3.annotationLabel)
                .annotations(annotations);
            
            setTimeout(() => {
                svg.append("g")
                    .attr("class", "annotation-group")
                    .call(makeAnnotations);
            }, 1200);
        }
        
        // Navigation functions
        function nextScene() {
            if (currentScene < totalScenes) {
                currentScene++;
                updateScene();
            }
        }
        
        function previousScene() {
            if (currentScene > 1) {
                currentScene--;
                updateScene();
            }
        }
        
        // Initialize first scene
        updateScene();
    </script>
</body>
</html>